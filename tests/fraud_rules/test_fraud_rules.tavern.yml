test_name: Правила фрода

marks:
  - usefixtures:
      - admin_token
      - generate_random_email

stages:
  - name: "Валидация DSL (Valid)"
    request:
      url: "{BASE_URL}/fraud-rules/validate"
      method: POST
      headers:
        Authorization: "Bearer {admin_token}"
      json:
        dslExpression: "amount > 10000"
    response:
      status_code: 200
      json:
        isValid: true

  - name: "Создать правило"
    request:
      url: "{BASE_URL}/fraud-rules"
      method: POST
      headers:
        Authorization: "Bearer {admin_token}"
      json:
        name: "Test Rule {generate_random_email}"
        description: "Test rule"
        dslExpression: "amount > 999999"
        priority: 10
        enabled: true
    response:
      status_code: 201
      json:
        name: "Test Rule {generate_random_email}"
      save:
        json:
          rule_id: id

  - name: "Список правил"
    request:
      url: "{BASE_URL}/fraud-rules"
      method: GET
      headers:
        Authorization: "Bearer {admin_token}"
    response:
      status_code: 200
      json:
        - id: "{rule_id}"
          name: "Test Rule {generate_random_email}"