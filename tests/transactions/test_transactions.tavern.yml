test_name: Транзакции

marks:
  - usefixtures:
      - user_token
      - admin_token
      - user_id
      - other_user_id

stages:
  - name: "Создать транзакцию (Approved)"
    request:
      url: "{BASE_URL}/transactions"
      method: POST
      headers:
        Authorization: "Bearer {user_token}"
      json:
        userId: "{user_id}"
        amount: 100.00
        currency: "RUB"
        timestamp: "2026-01-20T10:00:00Z" # Ensure timestamp is valid relative to now? Spec says > now + 5 min is error. Past is ok?
    response:
      status_code: 201
      json:
        transaction:
          status: APPROVED
          amount: 100.0
      save:
        json:
          tx_id: transaction.id

  - name: "Получить транзакцию"
    request:
      url: "{BASE_URL}/transactions/{tx_id}"
      method: GET
      headers:
        Authorization: "Bearer {user_token}"
    response:
      status_code: 200
      json:
        transaction:
          id: "{tx_id}"
          status: APPROVED

  - name: "Попытка создать транзакцию для несуществующего пользователя"
    request:
      url: "{BASE_URL}/transactions"
      method: POST
      headers:
        Authorization: "Bearer {admin_token}"
      json:
        userId: "{other_user_id}"
        amount: 100.00
        currency: "RUB"
        timestamp: "2026-01-20T10:00:00Z"
    response:
      status_code: 404
      json:
        details:
          userId: "{other_user_id}"
