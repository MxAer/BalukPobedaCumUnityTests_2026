test_name: Full Stats Coverage

marks:
  - usefixtures:
      - admin_token
      - user_token
      - user_id

stages:
  - name: "Stats Overview"
    request:
      url: "{BASE_URL}/stats/overview"
      method: GET
      headers:
        Authorization: "Bearer {admin_token}"
    response:
      status_code: 200
      json:
        volume: !anything
        gmv: !anything
        approvalRate: !anything
        declineRate: !anything

  - name: "Transactions Timeseries"
    request:
      url: "{BASE_URL}/stats/transactions/timeseries"
      method: GET
      headers:
        Authorization: "Bearer {admin_token}"
      params:
        groupBy: day
    response:
      status_code: 200
      json:
        points: !anything

  - name: "Rule Matches"
    request:
      url: "{BASE_URL}/stats/rules/matches"
      method: GET
      headers:
        Authorization: "Bearer {admin_token}"
    response:
      status_code: 200
      json:
        items: !anything

  - name: "Merchant Risk"
    request:
      url: "{BASE_URL}/stats/merchants/risk"
      method: GET
      headers:
        Authorization: "Bearer {admin_token}"
    response:
      status_code: 200
      json:
        items: !anything

  - name: "User Risk Profile (Self)"
    request:
      url: "{BASE_URL}/stats/users/{user_id}/risk-profile"
      method: GET
      headers:
        Authorization: "Bearer {user_token}"
    response:
      status_code: 200
      json:
        userId: "{user_id}"
        txCount_24h: !anything
