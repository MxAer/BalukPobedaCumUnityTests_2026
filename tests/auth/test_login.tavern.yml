test_name: Аутентификация (Login)

marks:
  - usefixtures:
      - generate_random_email

stages:
  - name: "Регистрация пользователя (для проверки логина)"
    request:
      url: "{BASE_URL}/auth/register"
      method: POST
      json:
        email: "{generate_random_email}"
        password: "Password123!"
        fullName: "Login Tester"
        age: 30
        region: RU
        gender: MALE
        maritalStatus: SINGLE
    response:
      status_code: 201

  - name: "Успешный логин (User)"
    request:
      url: "{BASE_URL}/auth/login"
      method: POST
      json:
        email: "{generate_random_email}"
        password: "Password123!"
    response:
      status_code: 200
      json:
        user:
          email: "{generate_random_email}"
        accessToken: !anything

  - name: "Успешный логин (Admin)"
    request:
      url: "{BASE_URL}/auth/login"
      method: POST
      json:
        email: "{ADMIN_EMAIL}"
        password: "{ADMIN_PASSWORD}"
    response:
      status_code: 200
      json:
        user:
          role: ADMIN

  - name: "Логин с неверным паролем"
    request:
      url: "{BASE_URL}/auth/login"
      method: POST
      json:
        email: "{generate_random_email}"
        password: "WrongPassword"
    response:
      status_code: 401
