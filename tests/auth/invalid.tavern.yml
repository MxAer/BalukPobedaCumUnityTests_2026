test_name: Auth Invalid Scenarios

marks:
  - usefixtures:
      - generate_random_email
      - admin_token

stages:
  - name: "Register Conflict (409)"
    request:
      url: "{BASE_URL}/auth/register"
      method: POST
      json:
        email: "{generate_random_email}"
        password: "Password123!"
        fullName: "Conflict User"
    response:
      status_code: 201

  - name: "Register Conflict Repeat (409)"
    request:
      url: "{BASE_URL}/auth/register"
      method: POST
      json:
        email: "{generate_random_email}"
        password: "Password123!"
        fullName: "Conflict User"
    response:
      status_code: 409
      json:
        code: EMAIL_ALREADY_EXISTS

  - name: "Login Invalid Credentials (401)"
    request:
      url: "{BASE_URL}/auth/login"
      method: POST
      json:
        email: "{generate_random_email}"
        password: "WrongPassword"
    response:
      status_code: 401

  - name: "Login Deactivated User (423)"
    # Setup: Register -> Deactivate -> Login
    request:
      url: "{BASE_URL}/auth/register"
      method: POST
      json:
        email: "deact.{generate_random_email}"
        password: "Password123!"
        fullName: "To Be Deactivated"
    response:
      status_code: 201
      save:
        json:
          deact_token: accessToken
          deact_id: user.id

  - name: "Admin Deactivate"
    request:
      url: "{BASE_URL}/users/{deact_id}"
      method: DELETE
      headers:
        Authorization: "Bearer {admin_token}"
    response:
      status_code: 204

  - name: "Login Deactivated Check"
    request:
      url: "{BASE_URL}/auth/login"
      method: POST
      json:
        email: "deact.{generate_random_email}"
        password: "Password123!"
    response:
      status_code: 423
      json:
        code: USER_INACTIVE

  - name: "Profile Deactivated Check"
    request:
      url: "{BASE_URL}/users/me"
      method: GET
      headers:
        Authorization: "Bearer {deact_token}"
    response:
      status_code: 200
